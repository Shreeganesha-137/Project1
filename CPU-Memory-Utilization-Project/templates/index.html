<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Utilization Gauges</title>
<style>
  :root {
    --bg: #ffffff;
    --text: #333333;
    --band-green: #cfe9b5;
    --band-yellow: #f5e48a;
    --band-red: #f26c67;
    --progress: #215f8b; /* inner blue ring */
    --needle: #e62525;
    --track: #e9ecef;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; background: var(--bg); color: var(--text);
    font-family: system-ui, Arial, sans-serif;
  }
  .wrap {
    max-width: 980px; margin: 24px auto; padding: 0 16px;
  }
  h2 {
    text-align: center; font-weight: 600; margin: 28px 0 16px;
  }
  .gauge {
    width: 100%; max-width: 720px; margin: 0 auto 34px; position: relative;
  }
  .value-big {
    position: absolute; left: 50%; top: 58%;
    transform: translate(-50%, -50%);
    font-size: 64px; font-weight: 600; color: #222;
  }
  /* SVG sizing */
  .gauge svg { width: 100%; height: auto; display: block; }
  /* tick labels */
  .ticks text {
    fill: #777; font-size: 12px;
  }
  /* bands */
  .band { fill: none; stroke-linecap: butt; }
  .track { stroke: var(--track); }
  .band.green { stroke: var(--band-green); }
  .band.yellow{ stroke: var(--band-yellow); }
  .band.red   { stroke: var(--band-red); }
  .progress { fill: none; stroke: var(--progress); }
  .needle { stroke: var(--needle); stroke-width: 4; stroke-linecap: round; }
  .cap { fill: #555; }
  .title { text-anchor: middle; fill: #666; font-size: 16px; font-weight: 600; }
</style>
</head>
<body>
<div class="wrap">

  <div class="gauge" id="cpu">
    <h2>CPU Utilization</h2>
    <!-- 600Ã—320 viewBox fits a semicircle (padding for labels) -->
    <svg viewBox="0 0 600 320" aria-label="CPU Gauge">
      <!-- background track -->
      <path id="cpu-track" class="band track" stroke-width="36"/>
      <!-- colored bands -->
      <path id="cpu-band-green"  class="band green"  stroke-width="36"/>
      <path id="cpu-band-yellow" class="band yellow" stroke-width="36"/>
      <path id="cpu-band-red"    class="band red"    stroke-width="36"/>

      <!-- inner progress ring (thinner & inside) -->
      <path id="cpu-progress" class="progress" stroke-width="18"/>

      <!-- ticks & numbers -->
      <g class="ticks" id="cpu-ticks"></g>

      <!-- needle -->
      <line id="cpu-needle" class="needle" x1="300" y1="280" x2="300" y2="110"/>
      <circle class="cap" cx="300" cy="280" r="6"/>

      <!-- title inside SVG (optional) -->
      <!-- <text x="300" y="36" class="title">CPU Utilization</text> -->
    </svg>
    <div id="cpu-value" class="value-big">0.0</div>
  </div>

  <div class="gauge" id="mem">
    <h2>Memory Utilization</h2>
    <svg viewBox="0 0 600 320" aria-label="Memory Gauge">
      <path id="mem-track" class="band track" stroke-width="36"/>
      <path id="mem-band-green"  class="band green"  stroke-width="36"/>
      <path id="mem-band-yellow" class="band yellow" stroke-width="36"/>
      <path id="mem-band-red"    class="band red"    stroke-width="36"/>

      <path id="mem-progress" class="progress" stroke-width="18"/>

      <g class="ticks" id="mem-ticks"></g>

      <line id="mem-needle" class="needle" x1="300" y1="280" x2="300" y2="110"/>
      <circle class="cap" cx="300" cy="280" r="6"/>
    </svg>
    <div id="mem-value" class="value-big">0.0</div>
  </div>

</div>

<script>
/* ---------- geometry helpers (SVG arc) ---------- */
function polarToCartesian(cx, cy, r, deg){
  const rad = (deg-90) * Math.PI/180;
  return { x: cx + r * Math.cos(rad), y: cy + r * Math.sin(rad) };
}
function arcPath(cx, cy, r, startDeg, endDeg){
  const start = polarToCartesian(cx, cy, r, endDeg);
  const end   = polarToCartesian(cx, cy, r, startDeg);
  const large = endDeg - startDeg <= 180 ? "0" : "1";
  return `M ${start.x} ${start.y} A ${r} ${r} 0 ${large} 0 ${end.x} ${end.y}`;
}
/* map percent 0..100 -> angle -90..+90 */
const pctToDeg = p => -90 + (p * 180 / 100);

/* ---------- draw static parts (bands, ticks) ---------- */
function setupGauge(prefix){
  const cx=300, cy=280, R=220;               // band radius
  const Rprogress=200;                        // inner ring
  // full track (0..100)
  document.getElementById(`${prefix}-track`)
    .setAttribute("d", arcPath(cx, cy, R, -90, 90));

  // colored bands: 0-60 green, 60-80 yellow, 80-100 red
  document.getElementById(`${prefix}-band-green`)
    .setAttribute("d", arcPath(cx, cy, R, -90, pctToDeg(60)));
  document.getElementById(`${prefix}-band-yellow`)
    .setAttribute("d", arcPath(cx, cy, R, pctToDeg(60), pctToDeg(80)));
  document.getElementById(`${prefix}-band-red`)
    .setAttribute("d", arcPath(cx, cy, R, pctToDeg(80), 90));

  // progress ring initial (0%)
  document.getElementById(`${prefix}-progress`)
    .setAttribute("d", arcPath(cx, cy, Rprogress, -90, -90));

  // ticks & numbers at 0,20,40,60,80,100
  const g = document.getElementById(`${prefix}-ticks`);
  g.innerHTML = "";
  [0,20,40,60,80,100].forEach(p=>{
    const a = pctToDeg(p);
    const p1 = polarToCartesian(cx, cy, R+6, a);
    const p2 = polarToCartesian(cx, cy, R-22, a);
    const tl = document.createElementNS("http://www.w3.org/2000/svg","line");
    tl.setAttribute("x1", p1.x); tl.setAttribute("y1", p1.y);
    tl.setAttribute("x2", p2.x); tl.setAttribute("y2", p2.y);
    tl.setAttribute("stroke", "#b6b6b6"); tl.setAttribute("stroke-width", "2");
    g.appendChild(tl);

    const labelPos = polarToCartesian(cx, cy, R-36, a);
    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x", labelPos.x); t.setAttribute("y", labelPos.y+4);
    t.setAttribute("text-anchor","middle");
    t.textContent = p.toString();
    g.appendChild(t);
  });
}

/* ---------- live updates ---------- */
function setGauge(prefix, value){
  const cx=300, cy=280, Rprogress=200;
  // progress arc from -90 up to current angle
  const end = pctToDeg(value);
  const path = arcPath(cx, cy, Rprogress, -90, end);
  const prog = document.getElementById(`${prefix}-progress`);
  prog.setAttribute("d", path);

  // needle rotation
  const needle = document.getElementById(`${prefix}-needle`);
  needle.style.transformOrigin = "300px 280px";
  needle.style.transform = `rotate(${end + 90 - 90}deg)`; // keep as end degrees

  // big number
  document.getElementById(`${prefix}-value`).textContent = value.toFixed(1);

  // optional: change progress color based on range (keeps bands fixed like screenshot)
  const color = (value < 60) ? "#215f8b" : (value < 80) ? "#caa836" : "#b23b3b";
  prog.setAttribute("stroke", color);
}

/* init */
setupGauge("cpu");
setupGauge("mem");

/* fetch loop */
function refresh(){
  fetch("/stats")
    .then(r=>r.json())
    .then(({cpu, memory})=>{
      setGauge("cpu", cpu);
      setGauge("mem", memory);
    })
    .catch(()=>{ /* ignore transient errors */ });
}
refresh();
setInterval(refresh, 1000);
</script>
</body>
</html>
